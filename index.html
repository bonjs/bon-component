<html ng-app="app" >
	<head>
		
		<link type="text/css" rel="stylesheet" href=src/css/table.css />
	
		<script src="http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"></script> 
	
		<script src="src/js/Extend.js"></script>
		<script src="src/js/Observable.js"></script>
		<script src="src/js/Component.js"></script>
		<script src="src/js/ComponentAngular.js"></script>
		<script src="src/js/data.js"></script>
		
		<script type="html" id="template">
			<div class="component-table">
				<div class="locked-columns">
					<table class="columns-title" border="0" cellspacing="0" cellpadding="0" >
					  <tr>
						<td ng-repeat="col in lockedColumnsTitles">
							{{col.header}}
							<span class="sortable-icon" ng-if="col.sortable === true" ng-class="col.sort != 'desc' ? 'asc' : 'desc'" ng-click="sortClick(col)">
							</span>
						</td>
					  </tr>
					</table>
					<table class="columns-content" border="0" cellspacing="0" cellpadding="0" id="locked-block">
					  <tr ng-repeat="row in data">
						<td ng-repeat="col in lockedColumnsTitles">{{row[col.dataIndex]}}</td>
					  </tr> 
					</table>
				</div>

				<div class="unlocked-columns">
					<table class="columns-title" border="0" cellspacing="0" cellpadding="0" id="tableDiv_title" >
					  <tr>
						<td ng-repeat="col in unlockedColumnsTitles">
							{{col.header}}
							<span class="sortable-icon" ng-if="col.sortable === true" ng-class="col.sort != 'desc' ? 'asc' : 'desc'" ng-click="sortClick(col)">
							</span>
						</td>
					  </tr>
					</table>
					<table class="columns-content" border="0" cellspacing="0" cellpadding="0" 
						onscroll='divScroll(this);' onmousewheel="divScroll(this);" onwheel="divScroll(this);">
					  <tr ng-repeat="row in data">
						<td ng-repeat="col in unlockedColumnsTitles">{{row[col.dataIndex]}}</td>
					  </tr>      
					</table>
				</div>
				<div style="clear:both;"></div>
			</div>
		</script>
		
		<script>
		
			var Table = extend(ComponentAngular, {
				//html: "<button ng-click='say()'>{{userName}}</button>",
				
				constructor: function(a) {
				
					debugger;
					this.super(arguments);
					
					var me = this;
					
					var app = angular.module("app", []);
					app.controller('main', ['$scope', '$compile', function ($scope, $compile) {
						
						window.s = me.scope = $scope;
						
						me.scope.data = me.data;
						
						$scope.sortClick = me.sortClick.bind(me);
						
						//通过$compile动态编译html
						var template = angular.element(me.html);
						var el = $compile(template)($scope);
						
						angular.element(document.body).append(el);
						me.initTable();
					}]);
				},
				initTable: function() {
					var me = this;
					this.scope.lockedColumnsTitles = this.columns.filter(function(it) {
						return it.locked === true;
					});
					
					this.scope.unlockedColumnsTitles = this.columns.filter(function(it) {
						return it.locked !== true;
					});
				},
				sortClick: function(col) {
					col.sort = (col.sort == 'asc' || col.sort == undefined) ? 'desc' : 'asc';
					
					this.scope.data.sort(function(a, b) {
						debugger;
						if(col.sort == 'asc') {
							return a[col.dataIndex] < b[col.dataIndex];
						} else {
							return a[col.dataIndex] > b[col.dataIndex];
						}
					});
				}
			});
			
			var table = new Table({
				html: template.innerHTML,
				data: data,
				columns: [
					{
						header : '编号',
						dataIndex : 'id',
						sortable: true,
						locked: true
					}, {
						header : '姓名',
						dataIndex : 'name',
						sortable: true,
						locked: true
					}, {
						header : '语文',
						sortable: true,
						dataIndex : 'chinese'
					}, {
						header : '数学',
						dataIndex : 'math'
					}, {
						header : '英语',
						dataIndex : 'english'
					}, {
						header : '物理',
						dataIndex : 'physics'
					}, {
						header : '生物',
						dataIndex : 'biology'
					}, {
						header : '化学',
						dataIndex : 'chemistry'
					}
				],
			});
			
			
			
			function divScroll(scrollDiv) {
				var scrollTop = scrollDiv.scrollTop;
				var scrollLeft = scrollDiv.scrollLeft;
				
				document.getElementById("locked-block").scrollTop = scrollTop;
				document.getElementById("tableDiv_title").scrollLeft = scrollLeft;
			}
			
			function wheel(event) {
				var evt = event || window.event;
				var bodyDivY = document.getElementById("tableDiv_y");
				var scrollDivY = document.getElementById("scrollDiv_y");
				scrollDivY.scrollTop = scrollDivY.scrollTop + evt.deltaY * 7;
			}
		
			
		</script>
	</head>
	<body ng-controller="main">
		
	</body> 
</html>